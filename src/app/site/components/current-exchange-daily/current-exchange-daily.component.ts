import { Component, Input, OnInit } from '@angular/core';
import { HomeService } from '../../services/home.service';

@Component({
  selector: 'app-current-exchange-daily',
  templateUrl: './current-exchange-daily.component.html',
  styleUrls: ['./current-exchange-daily.component.scss']
})
export class CurrentExchangeDailyComponent implements OnInit {
  @Input() fromSymbol: string = '';
  @Input() indShowCards: boolean = false;
  loading: boolean = false;
  dailyExchangeRate: any[] = [];
  isCloseDiffPositive: boolean = true;
  lastMonth: any;

  mocke = {
    "success": true,
    "from": "USD",
    "to": "BRL",
    "lastUpdatedAt": "2023-11-03T21:55:00.000+00:00",
    "data": [
      {
        "open": 4.9012,
        "high": 4.9012,
        "low": 4.8934,
        "close": 4.8934,
        "date": "2023-11-04T03:00:00.000+00:00"
      },
      {
        "open": 4.9534,
        "high": 4.972,
        "low": 4.8751,
        "close": 4.8934,
        "date": "2023-11-03T03:00:00.000+00:00"
      },
      {
        "open": 4.9529,
        "high": 4.9542,
        "low": 4.8778,
        "close": 4.9529,
        "date": "2023-11-02T03:00:00.000+00:00"
      },
      {
        "open": 4.9537,
        "high": 4.9537,
        "low": 4.92229,
        "close": 4.9537,
        "date": "2023-11-01T03:00:00.000+00:00"
      },
      {
        "open": 5.0341,
        "high": 5.0428,
        "low": 5.0046,
        "close": 5.0341,
        "date": "2023-10-31T03:00:00.000+00:00"
      },
      {
        "open": 5.0461,
        "high": 5.0679,
        "low": 5.01004,
        "close": 5.0461,
        "date": "2023-10-30T03:00:00.000+00:00"
      },
      {
        "open": 4.95203,
        "high": 5.0478,
        "low": 4.95203,
        "close": 4.95203,
        "date": "2023-10-29T03:00:00.000+00:00"
      },
      {
        "open": 4.9853,
        "high": 4.9874,
        "low": 4.9302,
        "close": 4.9853,
        "date": "2023-10-26T03:00:00.000+00:00"
      },
      {
        "open": 4.9947,
        "high": 5.0148,
        "low": 4.98661,
        "close": 4.9947,
        "date": "2023-10-25T03:00:00.000+00:00"
      },
      {
        "open": 4.991,
        "high": 5.0165,
        "low": 4.9859,
        "close": 4.991,
        "date": "2023-10-24T03:00:00.000+00:00"
      },
      {
        "open": 5.0123,
        "high": 5.0261,
        "low": 4.97146,
        "close": 5.0123,
        "date": "2023-10-23T03:00:00.000+00:00"
      },
      {
        "open": 5.0313,
        "high": 5.04971,
        "low": 4.9992,
        "close": 5.0313,
        "date": "2023-10-22T03:00:00.000+00:00"
      },
      {
        "open": 5.0629,
        "high": 5.0954,
        "low": 5.02459,
        "close": 5.0629,
        "date": "2023-10-19T03:00:00.000+00:00"
      },
      {
        "open": 5.0561,
        "high": 5.0721,
        "low": 5.02306,
        "close": 5.0561,
        "date": "2023-10-18T03:00:00.000+00:00"
      },
      {
        "open": 5.0374,
        "high": 5.0735,
        "low": 5.01003,
        "close": 5.0374,
        "date": "2023-10-17T03:00:00.000+00:00"
      },
      {
        "open": 5.0376,
        "high": 5.0638,
        "low": 5.00882,
        "close": 5.0376,
        "date": "2023-10-16T03:00:00.000+00:00"
      },
      {
        "open": 5.0482,
        "high": 5.0816,
        "low": 5.02602,
        "close": 5.0482,
        "date": "2023-10-15T03:00:00.000+00:00"
      },
      {
        "open": 5.0459,
        "high": 5.0798,
        "low": 5.0427,
        "close": 5.0459,
        "date": "2023-10-12T03:00:00.000+00:00"
      },
      {
        "open": 5.0496,
        "high": 5.0496,
        "low": 5.01902,
        "close": 5.0496,
        "date": "2023-10-11T03:00:00.000+00:00"
      },
      {
        "open": 5.051,
        "high": 5.0596,
        "low": 5.028,
        "close": 5.051,
        "date": "2023-10-10T03:00:00.000+00:00"
      },
      {
        "open": 5.1352,
        "high": 5.136,
        "low": 5.0628,
        "close": 5.1352,
        "date": "2023-10-09T03:00:00.000+00:00"
      },
      {
        "open": 5.1457,
        "high": 5.1755,
        "low": 5.14319,
        "close": 5.1457,
        "date": "2023-10-08T03:00:00.000+00:00"
      },
      {
        "open": 5.165,
        "high": 5.2153,
        "low": 5.12066,
        "close": 5.165,
        "date": "2023-10-05T03:00:00.000+00:00"
      },
      {
        "open": 5.1546,
        "high": 5.1849,
        "low": 5.13542,
        "close": 5.1546,
        "date": "2023-10-04T03:00:00.000+00:00"
      },
      {
        "open": 5.1663,
        "high": 5.1759,
        "low": 5.12289,
        "close": 5.1663,
        "date": "2023-10-03T03:00:00.000+00:00"
      },
      {
        "open": 5.0615,
        "high": 5.1346,
        "low": 5.05992,
        "close": 5.0615,
        "date": "2023-10-02T03:00:00.000+00:00"
      },
      {
        "open": 5.0428,
        "high": 5.0761,
        "low": 5.02074,
        "close": 5.0428,
        "date": "2023-10-01T03:00:00.000+00:00"
      },
      {
        "open": 5.0328,
        "high": 5.0356,
        "low": 4.9886,
        "close": 5.0328,
        "date": "2023-09-28T03:00:00.000+00:00"
      },
      {
        "open": 5.0422,
        "high": 5.0652,
        "low": 5.01438,
        "close": 5.0422,
        "date": "2023-09-27T03:00:00.000+00:00"
      },
      {
        "open": 4.9862,
        "high": 5.0559,
        "low": 4.98325,
        "close": 4.9862,
        "date": "2023-09-26T03:00:00.000+00:00"
      },
      {
        "open": 4.9683,
        "high": 4.9829,
        "low": 4.93656,
        "close": 4.9683,
        "date": "2023-09-25T03:00:00.000+00:00"
      },
      {
        "open": 4.9339,
        "high": 4.9652,
        "low": 4.9304,
        "close": 4.9339,
        "date": "2023-09-24T03:00:00.000+00:00"
      },
      {
        "open": 4.9349,
        "high": 4.9359,
        "low": 4.90172,
        "close": 4.9349,
        "date": "2023-09-21T03:00:00.000+00:00"
      },
      {
        "open": 4.8788,
        "high": 4.9305,
        "low": 4.87603,
        "close": 4.8788,
        "date": "2023-09-20T03:00:00.000+00:00"
      },
      {
        "open": 4.8658,
        "high": 4.8679,
        "low": 4.83874,
        "close": 4.8658,
        "date": "2023-09-19T03:00:00.000+00:00"
      },
      {
        "open": 4.8537,
        "high": 4.8625,
        "low": 4.83539,
        "close": 4.8537,
        "date": "2023-09-18T03:00:00.000+00:00"
      },
      {
        "open": 4.867,
        "high": 4.8726,
        "low": 4.84246,
        "close": 4.867,
        "date": "2023-09-17T03:00:00.000+00:00"
      },
      {
        "open": 4.8682,
        "high": 4.8754,
        "low": 4.8577,
        "close": 4.8682,
        "date": "2023-09-14T03:00:00.000+00:00"
      },
      {
        "open": 4.9154,
        "high": 4.9172,
        "low": 4.86184,
        "close": 4.9154,
        "date": "2023-09-13T03:00:00.000+00:00"
      },
      {
        "open": 4.9466,
        "high": 4.96,
        "low": 4.8973,
        "close": 4.9466,
        "date": "2023-09-12T03:00:00.000+00:00"
      },
      {
        "open": 4.9294,
        "high": 4.9661,
        "low": 4.92708,
        "close": 4.9294,
        "date": "2023-09-11T03:00:00.000+00:00"
      },
      {
        "open": 4.983,
        "high": 4.9856,
        "low": 4.9275,
        "close": 4.983,
        "date": "2023-09-10T03:00:00.000+00:00"
      },
      {
        "open": 4.9761,
        "high": 4.9918,
        "low": 4.9635,
        "close": 4.9761,
        "date": "2023-09-07T03:00:00.000+00:00"
      },
      {
        "open": 4.977,
        "high": 4.9785,
        "low": 4.9738,
        "close": 4.977,
        "date": "2023-09-06T03:00:00.000+00:00"
      },
      {
        "open": 4.9667,
        "high": 4.9921,
        "low": 4.92348,
        "close": 4.9667,
        "date": "2023-09-05T03:00:00.000+00:00"
      },
      {
        "open": 4.9362,
        "high": 4.9784,
        "low": 4.92984,
        "close": 4.9362,
        "date": "2023-09-04T03:00:00.000+00:00"
      },
      {
        "open": 4.9763,
        "high": 4.9769,
        "low": 4.90695,
        "close": 4.9763,
        "date": "2023-09-03T03:00:00.000+00:00"
      },
      {
        "open": 4.9538,
        "high": 4.9546,
        "low": 4.8988,
        "close": 4.9538,
        "date": "2023-08-31T03:00:00.000+00:00"
      },
      {
        "open": 4.8884,
        "high": 4.9559,
        "low": 4.8672,
        "close": 4.8884,
        "date": "2023-08-30T03:00:00.000+00:00"
      },
      {
        "open": 4.8513,
        "high": 4.8808,
        "low": 4.82209,
        "close": 4.8513,
        "date": "2023-08-29T03:00:00.000+00:00"
      },
      {
        "open": 4.8726,
        "high": 4.8996,
        "low": 4.84309,
        "close": 4.8726,
        "date": "2023-08-28T03:00:00.000+00:00"
      },
      {
        "open": 4.8704,
        "high": 4.8994,
        "low": 4.85968,
        "close": 4.8704,
        "date": "2023-08-27T03:00:00.000+00:00"
      },
      {
        "open": 4.8803,
        "high": 4.8974,
        "low": 4.85525,
        "close": 4.8803,
        "date": "2023-08-24T03:00:00.000+00:00"
      },
      {
        "open": 4.8551,
        "high": 4.8833,
        "low": 4.85388,
        "close": 4.8551,
        "date": "2023-08-23T03:00:00.000+00:00"
      },
      {
        "open": 4.9371,
        "high": 4.9412,
        "low": 4.86755,
        "close": 4.9371,
        "date": "2023-08-22T03:00:00.000+00:00"
      },
      {
        "open": 4.9787,
        "high": 4.9792,
        "low": 4.92295,
        "close": 4.9787,
        "date": "2023-08-21T03:00:00.000+00:00"
      },
      {
        "open": 4.9669,
        "high": 4.9938,
        "low": 4.95019,
        "close": 4.9669,
        "date": "2023-08-20T03:00:00.000+00:00"
      },
      {
        "open": 4.9755,
        "high": 4.9956,
        "low": 4.9595,
        "close": 4.9755,
        "date": "2023-08-17T03:00:00.000+00:00"
      },
      {
        "open": 4.9869,
        "high": 4.9928,
        "low": 4.958,
        "close": 4.9869,
        "date": "2023-08-16T03:00:00.000+00:00"
      },
      {
        "open": 4.9832,
        "high": 4.9883,
        "low": 4.95127,
        "close": 4.9832,
        "date": "2023-08-15T03:00:00.000+00:00"
      },
      {
        "open": 4.9621,
        "high": 4.9956,
        "low": 4.9577,
        "close": 4.9621,
        "date": "2023-08-14T03:00:00.000+00:00"
      },
      {
        "open": 4.911,
        "high": 4.9619,
        "low": 4.88969,
        "close": 4.911,
        "date": "2023-08-13T03:00:00.000+00:00"
      },
      {
        "open": 4.8915,
        "high": 4.9043,
        "low": 4.86094,
        "close": 4.8915,
        "date": "2023-08-10T03:00:00.000+00:00"
      },
      {
        "open": 4.9017,
        "high": 4.9039,
        "low": 4.83852,
        "close": 4.9017,
        "date": "2023-08-09T03:00:00.000+00:00"
      },
      {
        "open": 4.8986,
        "high": 4.9107,
        "low": 4.8725,
        "close": 4.8986,
        "date": "2023-08-08T03:00:00.000+00:00"
      },
      {
        "open": 4.899,
        "high": 4.93681,
        "low": 4.89481,
        "close": 4.899,
        "date": "2023-08-07T03:00:00.000+00:00"
      },
      {
        "open": 4.8854,
        "high": 4.9107,
        "low": 4.85941,
        "close": 4.8854,
        "date": "2023-08-06T03:00:00.000+00:00"
      },
      {
        "open": 4.9164,
        "high": 4.9183,
        "low": 4.8456,
        "close": 4.9164,
        "date": "2023-08-03T03:00:00.000+00:00"
      },
      {
        "open": 4.8104,
        "high": 4.8932,
        "low": 4.80849,
        "close": 4.8104,
        "date": "2023-08-02T03:00:00.000+00:00"
      },
      {
        "open": 4.792,
        "high": 4.8188,
        "low": 4.77811,
        "close": 4.792,
        "date": "2023-08-01T03:00:00.000+00:00"
      },
      {
        "open": 4.7247,
        "high": 4.7885,
        "low": 4.72076,
        "close": 4.7247,
        "date": "2023-07-31T03:00:00.000+00:00"
      },
      {
        "open": 4.7233,
        "high": 4.758,
        "low": 4.70223,
        "close": 4.7233,
        "date": "2023-07-30T03:00:00.000+00:00"
      },
      {
        "open": 4.7416,
        "high": 4.7485,
        "low": 4.69568,
        "close": 4.7416,
        "date": "2023-07-27T03:00:00.000+00:00"
      },
      {
        "open": 4.7362,
        "high": 4.7369,
        "low": 4.7094,
        "close": 4.7362,
        "date": "2023-07-26T03:00:00.000+00:00"
      },
      {
        "open": 4.7489,
        "high": 4.7533,
        "low": 4.7272,
        "close": 4.7489,
        "date": "2023-07-25T03:00:00.000+00:00"
      },
      {
        "open": 4.7255,
        "high": 4.7563,
        "low": 4.71533,
        "close": 4.7255,
        "date": "2023-07-24T03:00:00.000+00:00"
      },
      {
        "open": 4.7774,
        "high": 4.7792,
        "low": 4.72037,
        "close": 4.7774,
        "date": "2023-07-23T03:00:00.000+00:00"
      },
      {
        "open": 4.7969,
        "high": 4.81396,
        "low": 4.75929,
        "close": 4.7969,
        "date": "2023-07-20T03:00:00.000+00:00"
      },
      {
        "open": 4.7899,
        "high": 4.8082,
        "low": 4.7678,
        "close": 4.7899,
        "date": "2023-07-19T03:00:00.000+00:00"
      },
      {
        "open": 4.8093,
        "high": 4.8171,
        "low": 4.7834,
        "close": 4.8093,
        "date": "2023-07-18T03:00:00.000+00:00"
      },
      {
        "open": 4.8058,
        "high": 4.8251,
        "low": 4.76277,
        "close": 4.8058,
        "date": "2023-07-17T03:00:00.000+00:00"
      },
      {
        "open": 4.7881,
        "high": 4.847,
        "low": 4.77234,
        "close": 4.7881,
        "date": "2023-07-16T03:00:00.000+00:00"
      },
      {
        "open": 4.7948,
        "high": 4.8063,
        "low": 4.77175,
        "close": 4.7948,
        "date": "2023-07-13T03:00:00.000+00:00"
      },
      {
        "open": 4.8169,
        "high": 4.82276,
        "low": 4.7798,
        "close": 4.8169,
        "date": "2023-07-12T03:00:00.000+00:00"
      },
      {
        "open": 4.8515,
        "high": 4.8584,
        "low": 4.783,
        "close": 4.8515,
        "date": "2023-07-11T03:00:00.000+00:00"
      },
      {
        "open": 4.8982,
        "high": 4.9198,
        "low": 4.87941,
        "close": 4.8982,
        "date": "2023-07-10T03:00:00.000+00:00"
      },
      {
        "open": 4.8709,
        "high": 4.8912,
        "low": 4.8561,
        "close": 4.8709,
        "date": "2023-07-09T03:00:00.000+00:00"
      },
      {
        "open": 4.9187,
        "high": 4.9294,
        "low": 4.85909,
        "close": 4.9187,
        "date": "2023-07-06T03:00:00.000+00:00"
      },
      {
        "open": 4.8472,
        "high": 4.9239,
        "low": 4.83889,
        "close": 4.8472,
        "date": "2023-07-05T03:00:00.000+00:00"
      },
      {
        "open": 4.8399,
        "high": 4.8682,
        "low": 4.8368,
        "close": 4.8399,
        "date": "2023-07-04T03:00:00.000+00:00"
      },
      {
        "open": 4.8065,
        "high": 4.8174,
        "low": 4.7818,
        "close": 4.8065,
        "date": "2023-07-03T03:00:00.000+00:00"
      },
      {
        "open": 4.7842,
        "high": 4.7929,
        "low": 4.75814,
        "close": 4.7842,
        "date": "2023-07-02T03:00:00.000+00:00"
      },
      {
        "open": 4.8556,
        "high": 4.8675,
        "low": 4.8093,
        "close": 4.8556,
        "date": "2023-06-29T03:00:00.000+00:00"
      },
      {
        "open": 4.8505,
        "high": 4.8716,
        "low": 4.80995,
        "close": 4.8505,
        "date": "2023-06-28T03:00:00.000+00:00"
      },
      {
        "open": 4.8105,
        "high": 4.8685,
        "low": 4.80814,
        "close": 4.8105,
        "date": "2023-06-27T03:00:00.000+00:00"
      },
      {
        "open": 4.7673,
        "high": 4.8044,
        "low": 4.7504,
        "close": 4.7673,
        "date": "2023-06-26T03:00:00.000+00:00"
      },
      {
        "open": 4.7855,
        "high": 4.7862,
        "low": 4.75775,
        "close": 4.7855,
        "date": "2023-06-25T03:00:00.000+00:00"
      },
      {
        "open": 4.76974,
        "high": 4.8026,
        "low": 4.76541,
        "close": 4.76974,
        "date": "2023-06-22T03:00:00.000+00:00"
      },
      {
        "open": 4.7623,
        "high": 4.7791,
        "low": 4.73741,
        "close": 4.7623,
        "date": "2023-06-21T03:00:00.000+00:00"
      },
      {
        "open": 4.7893,
        "high": 4.8145,
        "low": 4.7632,
        "close": 4.7893,
        "date": "2023-06-20T03:00:00.000+00:00"
      },
      {
        "open": 4.7769,
        "high": 4.7976,
        "low": 4.7722,
        "close": 4.7769,
        "date": "2023-06-19T03:00:00.000+00:00"
      }
    ]
  };

  constructor(private homeService: HomeService) { }

  ngOnInit() {
    if (this.indShowCards === true) {
      this.getDailyExchangeRate(this.fromSymbol);
    }
  }

  getDailyExchangeRate(fromSymbol: string): void {
    this.loading = true;
    const apiKey: string = 'RVZG0GHEV2KORLNA';
    const toSymbol: string = 'BRL';

    // console.log('fromSymbol', fromSymbol);

    this.homeService.getDailyExchangeRate(apiKey, fromSymbol, toSymbol).subscribe(data => {
      this.dailyExchangeRate = this.mocke.data;
      // this.dailyExchangeRate = data.data;

      for (let i = 1; i < this.dailyExchangeRate.length; i++) {
        const closingCurrent = this.dailyExchangeRate[i].close;
        const closingPrevious = this.dailyExchangeRate[i - 1].close;
        const difference = ((closingCurrent - closingPrevious) / closingPrevious) * 100;
        this.dailyExchangeRate[i - 1].closeDiff = Number(difference.toFixed(4));
        this.dailyExchangeRate[i - 1].signals = difference > 0 ? 'positive' : (difference < 0 ? 'negative' : 'equal');
      }

      this.lastMonth = this.dailyExchangeRate.slice(0, 30);
      // console.log('lastMonth', this.lastMonth);
    }, error => {
      console.error('Erro na API:', error);
    }).add(() => {
      this.loading = false;
    });
  }
}
